# 4.1 기본 지식
## 개요 
- **DirectX**는 응용프로그램에서 GPU를 제어하고 프로그래밍하는데 쓰이는 저수준 그래픽API이다.

## COM
- COM(compoent object model)은 DirectX의 프로그래밍 언어 독립성과 하위 호환성을 가능하게 하는 기술
- MS에서 개발한 소프트웨어 구성요소들의 응용 프로그램 이진 인터페이스로, 응용프로그램, 프로세스간에 사용되는 저수준 인터페이스

---

## 텍스처 형식
- 2차원 텍스처는 자료원소들의 행렬(2차원배열)이다.
- 단순 자료 배열인 것은 아니고, 훨씬 범용적이다.
- 필터링, multisampling(다중표본화) 등 특별한 연산을 텍스처에 적용할 수 있다.
- typeless형식도 존재하는데, 메모리만 확보하고 구체적 해석은 나중에 텍스처를 파이프라인에 bind할 때 지정한다.

## Swap Chain, Buffering
- 전면버퍼와 후면버퍼 두개의 버퍼를 이용하여 전면버퍼가 화면에 나타날 동안, 다음 프레임을 후면버퍼에 그리고, 역할을 맞바꾸는 방식으로 자연스러운 애니메이션을 표현한다.
- 전면버퍼와 후면버퍼의 역할을 교환하여 페이지가 전환되게 하는것을 Presenting(제시)라고 한다.
- 실제로는 버퍼의 포인터를 맞바꾸는 방식이다.
- 두 개의 버퍼를 이용하는 방식을 **Double-Buffering** 이라고 한다.

## 깊이 버퍼링
- 깊이버퍼(depth buffer)는 각 픽셀의 깊이정보를 담는다.
- 깊이버퍼 알고리즘은 렌더링되는 각 픽셀의 깊이값을 계산하여 깊이판정을 수행한다.
- 깊이 값을 비교해 관찰자에게 가장 가까운 픽셀이 채택되어 후면 버퍼에 기록된다.
- 깊이버퍼도 하나의 텍스쳐이며 이를 위한 자료형이 존재한다.

---

## 자원과 서술자
- 렌더링 과정에서 그리기 호출이 참조할 자원들을 렌더링 파이프라인에 묶어야 한다. (바인딩)
- 실제로 자원을 묶지는 않고, 해당 자원을 참조하는 descriptor(서술자) 객체가 파이프라인에 묶인다.
- desciptor는 자원의 사용법을 Direct3D에 말해준다.
  - 파이프라인의 어느 단계에 묶일지 설명(같은 자원도 파이프라인의 서로 다른 stage에서 사용될 수 있다)
  - 가능한 경우 파이프라인에 묶을 자원의 부분영역을 지정
  - 무형식 자원의 경우 descriptor 생성 시 구체적인 형식 명시 가능
- 응용프로그램이 사용하는 descriptor들은 descriptor hip에 저장된다.
- 응용프로그램의 초기화 시점에서 생성되어야 한다.

---

## Multisampling 
- 픽셀이 무한히 작지 않기 때문에 계단현상이라고 하는 'Aliasing'이 나타난다.
- 이를 해결하는 방법이 Antialiasing 기법인데, 예시로 supersampling(초과표본화)방식이 있다.
  - 후면과 깊이버퍼의 해상도를 4배 늘려서 후면 버퍼에 렌더링 한 후, 원래 해상도로 downsamling하여 4픽셀블록의 평균값을 출력한다.
  - 화면의 해상도를 소프트웨어에서 증가시키는 방법
  - 하지만 메모리소비량과 픽셀처리량 또한 4배가 되어 비용이 비싸다.
- multisampling(다중표본화)는 절충적인 안티앨리어싱 기법이다.
  - 픽셀을 부분픽셀(subpixel)로 나누고, 픽셀 당 한번만 계산한 후 그 색상과 부분픽셀의 가시성,포괄도를 이용해 최종 색상을 결정한다. 
  - 4X multisampling의 경우 해상도를 4배(픽셀당 부분픽셀 4개) 하여 계산한다는 의미.
  
## 기능수준
- feature level은 GPU가 지원하는 기능들의 엄격한 집합을 정의한다.
- D3D_FREATURE_LEVEL_9_3, D3D_FREATURE_LEVEL_10_1, D3D_FREATURE_LEVEL_11_1 등 여러 버전에 대응한다.

## DXGI
- DirectX Graphic Infrastructure의 약자로 다이렉트와 함께 쓰이는 API이다.
- 스왑체인, 전체화면모드전환, 디스플레이어댑터, 지원되는 디스플레이 모드 등 여러가지 공통적인 그래픽 기능성을 처리한다.
- ID3D12Device::CheckFeatureSupport 메서드로 기능 지원을 점검할 수 있다.

## 상주성
- Residency는 간단히 말해 자원이 GPU메모리에 올라가 있는지 여부를 뜻한다.
- 상주성 관리의 핵심은 응용프로그램이 사용하는 GPU메모리의 양을 최소화 하는 것이다.
- (메모리관리 잘 하라는 의미인듯)

## CPU-GPU 상호작용
- 병렬로 작동하는 cpu-gpu사이에는 동기화가 필요하지만, 성능을 위해서는 동기화를 최소화 해야한다.(동기화중에 노는 장치가 생기니까)
- -GPU에는 **command queue**가 있어서 cpu는 이곳에 명령을 제출한다.
- 이때 명령은 **command allocator**의 메모리에 저장된다. command queue는 이 할당자에 담긴 명령을 참조한다.
- gpu가 command allocator에 담긴 모든 명령을 실행했음이 확실해지기 전까진 allocator를 재설정하면 안된다. 순서때문에 의도치 않은 결과가 발생할 수 있음.
- 동기화에는 fence를 사용하여 명령이 전부 실행된 후에 다음 allocator를 재설정하도록 한다.